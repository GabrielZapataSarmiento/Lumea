document.addEventListener("DOMContentLoaded",function(){let lastVoteTime=0;const VOTE_DELAY=3e3;let debounceTimeout;function createButtonListener(love){return function(event){const card=event.target.closest(".card");if(!card)return;const voteType=love?"like":"dislike";const moveOutWidth=document.body.clientWidth*1;card.style.transition="transform 0.5s ease, opacity 0.5s ease";card.style.transform=`translate(${love?moveOutWidth:-moveOutWidth}px, -100px) rotate(${love?-15:15}deg)`;card.style.opacity="0";const currentTime=Date.now();if(currentTime-lastVoteTime>=VOTE_DELAY){lastVoteTime=currentTime;clearTimeout(debounceTimeout);debounceTimeout=setTimeout(()=>{},300)}setTimeout(()=>{card.remove();checkIfAllVoted()},500);event.preventDefault()}}function attachButtonListeners(){const dislikeButtons=document.querySelectorAll(".swipe-buttons button:first-child");const likeButtons=document.querySelectorAll(".swipe-buttons button:last-child");dislikeButtons.forEach(button=>{button.removeEventListener("click",createButtonListener(false));button.addEventListener("click",createButtonListener(false))});likeButtons.forEach(button=>{button.removeEventListener("click",createButtonListener(true));button.addEventListener("click",createButtonListener(true))})}function checkIfAllVoted(){const remainingCards=document.querySelectorAll(".card:not(.removed)").length;const noMoreCards=document.querySelector(".no-more-cards");if(remainingCards===0){noMoreCards.classList.remove("hidden")}else{noMoreCards.classList.add("hidden")}}function initCards(){const newCards=document.querySelectorAll(".card:not(.removed)");newCards.forEach((card,index)=>{const offset=index*2;card.style.cssText=`z-index: ${newCards.length-index}; transform: translate(-50%, calc(-50% + ${offset}px)); opacity: 1; position: absolute; left: 50%; top: calc(50% - ${offset}px);`});requestAnimationFrame(()=>{newCards.forEach(card=>{card.style.transition=""})});checkIfAllVoted(newCards.length);attachButtonListeners()}document.addEventListener("songsLoaded",function(){initCards()});initCards();document.addEventListener("DOMContentLoaded",function(){Livewire.dispatch("loadSongs")});setInterval(function(){Livewire.dispatch("loadSongs")},15e3);const observer=new MutationObserver(function(mutationsList){for(const mutation of mutationsList){if(mutation.type==="childList"&&mutation.addedNodes.length>0){attachButtonListeners()}}});observer.observe(document.body,{childList:true,subtree:true})});
